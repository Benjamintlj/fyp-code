{
 "Resources": {
  "fypLessonBucketB0B7A3CD": {
   "Type": "AWS::S3::Bucket",
   "UpdateReplacePolicy": "Retain",
   "DeletionPolicy": "Retain",
   "Metadata": {
    "aws:cdk:path": "CdkStack/fypLessonBucket/Resource"
   }
  },
  "fypCodeBucketB93229D9": {
   "Type": "AWS::S3::Bucket",
   "UpdateReplacePolicy": "Retain",
   "DeletionPolicy": "Retain",
   "Metadata": {
    "aws:cdk:path": "CdkStack/fypCodeBucket/Resource"
   }
  },
  "fypAccountsUserPool4EB75161": {
   "Type": "AWS::Cognito::UserPool",
   "Properties": {
    "AccountRecoverySetting": {
     "RecoveryMechanisms": [
      {
       "Name": "verified_phone_number",
       "Priority": 1
      },
      {
       "Name": "verified_email",
       "Priority": 2
      }
     ]
    },
    "AdminCreateUserConfig": {
     "AllowAdminCreateUserOnly": false
    },
    "AliasAttributes": [
     "email"
    ],
    "AutoVerifiedAttributes": [
     "email"
    ],
    "EmailVerificationMessage": "The verification code to your new account is {####}",
    "EmailVerificationSubject": "Verify your new account",
    "Schema": [
     {
      "Mutable": true,
      "Name": "email",
      "Required": true
     },
     {
      "AttributeDataType": "String",
      "Mutable": true,
      "Name": "leagueRank"
     },
     {
      "AttributeDataType": "String",
      "Mutable": true,
      "Name": "currentLeaderboardId"
     }
    ],
    "SmsVerificationMessage": "The verification code to your new account is {####}",
    "VerificationMessageTemplate": {
     "DefaultEmailOption": "CONFIRM_WITH_CODE",
     "EmailMessage": "The verification code to your new account is {####}",
     "EmailSubject": "Verify your new account",
     "SmsMessage": "The verification code to your new account is {####}"
    }
   },
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete",
   "Metadata": {
    "aws:cdk:path": "CdkStack/fypAccountsUserPool/Resource"
   }
  },
  "fypLeaderboardTableC629E552": {
   "Type": "AWS::DynamoDB::Table",
   "Properties": {
    "AttributeDefinitions": [
     {
      "AttributeName": "id",
      "AttributeType": "S"
     },
     {
      "AttributeName": "league_rank",
      "AttributeType": "S"
     }
    ],
    "GlobalSecondaryIndexes": [
     {
      "IndexName": "rank-index",
      "KeySchema": [
       {
        "AttributeName": "league_rank",
        "KeyType": "HASH"
       }
      ],
      "Projection": {
       "ProjectionType": "ALL"
      },
      "ProvisionedThroughput": {
       "ReadCapacityUnits": 5,
       "WriteCapacityUnits": 5
      }
     }
    ],
    "KeySchema": [
     {
      "AttributeName": "id",
      "KeyType": "HASH"
     }
    ],
    "ProvisionedThroughput": {
     "ReadCapacityUnits": 5,
     "WriteCapacityUnits": 5
    }
   },
   "UpdateReplacePolicy": "Retain",
   "DeletionPolicy": "Retain",
   "Metadata": {
    "aws:cdk:path": "CdkStack/fypLeaderboardTable/Resource"
   }
  },
  "fypLeaderboardEventBridgeA33866F8": {
   "Type": "AWS::Events::Rule",
   "Properties": {
    "ScheduleExpression": "rate(7 days)",
    "State": "ENABLED",
    "Targets": [
     {
      "Arn": {
       "Fn::GetAtt": [
        "fypLeaderboardScanE686BD04",
        "Arn"
       ]
      },
      "Id": "Target0"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "CdkStack/fypLeaderboardEventBridge/Resource"
   }
  },
  "fypLeaderboardEventBridgeAllowEventRuleCdkStackfypLeaderboardScan9375F54738DBD3B1": {
   "Type": "AWS::Lambda::Permission",
   "Properties": {
    "Action": "lambda:InvokeFunction",
    "FunctionName": {
     "Fn::GetAtt": [
      "fypLeaderboardScanE686BD04",
      "Arn"
     ]
    },
    "Principal": "events.amazonaws.com",
    "SourceArn": {
     "Fn::GetAtt": [
      "fypLeaderboardEventBridgeA33866F8",
      "Arn"
     ]
    }
   },
   "Metadata": {
    "aws:cdk:path": "CdkStack/fypLeaderboardEventBridge/AllowEventRuleCdkStackfypLeaderboardScan9375F547"
   }
  },
  "fypUpdateLeaderboardsSQSAFEAE517": {
   "Type": "AWS::SQS::Queue",
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete",
   "Metadata": {
    "aws:cdk:path": "CdkStack/fypUpdateLeaderboardsSQS/Resource"
   }
  },
  "fypLeaderboardScanServiceRole08A0FB94": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "CdkStack/fypLeaderboardScan/ServiceRole/Resource"
   }
  },
  "fypLeaderboardScanServiceRoleDefaultPolicy6B979F95": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "dynamodb:BatchGetItem",
        "dynamodb:ConditionCheckItem",
        "dynamodb:DescribeTable",
        "dynamodb:GetItem",
        "dynamodb:GetRecords",
        "dynamodb:GetShardIterator",
        "dynamodb:Query",
        "dynamodb:Scan"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "fypLeaderboardTableC629E552",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "fypLeaderboardTableC629E552",
             "Arn"
            ]
           },
           "/index/*"
          ]
         ]
        }
       ]
      },
      {
       "Action": [
        "sqs:GetQueueAttributes",
        "sqs:GetQueueUrl",
        "sqs:SendMessage"
       ],
       "Effect": "Allow",
       "Resource": {
        "Fn::GetAtt": [
         "fypUpdateLeaderboardsSQSAFEAE517",
         "Arn"
        ]
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "fypLeaderboardScanServiceRoleDefaultPolicy6B979F95",
    "Roles": [
     {
      "Ref": "fypLeaderboardScanServiceRole08A0FB94"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "CdkStack/fypLeaderboardScan/ServiceRole/DefaultPolicy/Resource"
   }
  },
  "fypLeaderboardScanE686BD04": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Architectures": [
     "arm64"
    ],
    "Code": {
     "S3Bucket": {
      "Ref": "fypCodeBucketB93229D9"
     },
     "S3Key": "fypLeaderboardScan.zip"
    },
    "Environment": {
     "Variables": {
      "LEADER_BOARD_TABLE": {
       "Ref": "fypLeaderboardTableC629E552"
      },
      "QUEUE_URL": {
       "Ref": "fypUpdateLeaderboardsSQSAFEAE517"
      }
     }
    },
    "Handler": "src.index.main",
    "Role": {
     "Fn::GetAtt": [
      "fypLeaderboardScanServiceRole08A0FB94",
      "Arn"
     ]
    },
    "Runtime": "python3.9",
    "Timeout": 30
   },
   "DependsOn": [
    "fypLeaderboardScanServiceRoleDefaultPolicy6B979F95",
    "fypLeaderboardScanServiceRole08A0FB94"
   ],
   "Metadata": {
    "aws:cdk:path": "CdkStack/fypLeaderboardScan/Resource"
   }
  },
  "fypUpdateLeaderboardsServiceRoleDD8CAE43": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "CdkStack/fypUpdateLeaderboards/ServiceRole/Resource"
   }
  },
  "fypUpdateLeaderboardsServiceRoleDefaultPolicyB6F1EA6E": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": "cognito-idp:*",
       "Effect": "Allow",
       "Resource": {
        "Fn::GetAtt": [
         "fypAccountsUserPool4EB75161",
         "Arn"
        ]
       }
      },
      {
       "Action": [
        "dynamodb:BatchGetItem",
        "dynamodb:BatchWriteItem",
        "dynamodb:ConditionCheckItem",
        "dynamodb:DeleteItem",
        "dynamodb:DescribeTable",
        "dynamodb:GetItem",
        "dynamodb:GetRecords",
        "dynamodb:GetShardIterator",
        "dynamodb:PutItem",
        "dynamodb:Query",
        "dynamodb:Scan",
        "dynamodb:UpdateItem"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "fypLeaderboardTableC629E552",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "fypLeaderboardTableC629E552",
             "Arn"
            ]
           },
           "/index/*"
          ]
         ]
        }
       ]
      },
      {
       "Action": [
        "sqs:ChangeMessageVisibility",
        "sqs:DeleteMessage",
        "sqs:GetQueueAttributes",
        "sqs:GetQueueUrl",
        "sqs:ReceiveMessage"
       ],
       "Effect": "Allow",
       "Resource": {
        "Fn::GetAtt": [
         "fypUpdateLeaderboardsSQSAFEAE517",
         "Arn"
        ]
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "fypUpdateLeaderboardsServiceRoleDefaultPolicyB6F1EA6E",
    "Roles": [
     {
      "Ref": "fypUpdateLeaderboardsServiceRoleDD8CAE43"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "CdkStack/fypUpdateLeaderboards/ServiceRole/DefaultPolicy/Resource"
   }
  },
  "fypUpdateLeaderboards43E6BBC2": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Architectures": [
     "arm64"
    ],
    "Code": {
     "S3Bucket": {
      "Ref": "fypCodeBucketB93229D9"
     },
     "S3Key": "fypUpdateLeaderboards.zip"
    },
    "Environment": {
     "Variables": {
      "LEADER_BOARD_TABLE": {
       "Ref": "fypLeaderboardTableC629E552"
      },
      "QUEUE_URL": {
       "Ref": "fypUpdateLeaderboardsSQSAFEAE517"
      },
      "USER_POOL_ID": {
       "Ref": "fypAccountsUserPool4EB75161"
      }
     }
    },
    "Handler": "src.index.main",
    "Role": {
     "Fn::GetAtt": [
      "fypUpdateLeaderboardsServiceRoleDD8CAE43",
      "Arn"
     ]
    },
    "Runtime": "python3.9",
    "Timeout": 30
   },
   "DependsOn": [
    "fypUpdateLeaderboardsServiceRoleDefaultPolicyB6F1EA6E",
    "fypUpdateLeaderboardsServiceRoleDD8CAE43"
   ],
   "Metadata": {
    "aws:cdk:path": "CdkStack/fypUpdateLeaderboards/Resource"
   }
  },
  "fypUpdateLeaderboardsSqsEventSourceCdkStackfypUpdateLeaderboardsSQSA13E6ACE018F0ED4": {
   "Type": "AWS::Lambda::EventSourceMapping",
   "Properties": {
    "EventSourceArn": {
     "Fn::GetAtt": [
      "fypUpdateLeaderboardsSQSAFEAE517",
      "Arn"
     ]
    },
    "FunctionName": {
     "Ref": "fypUpdateLeaderboards43E6BBC2"
    }
   },
   "Metadata": {
    "aws:cdk:path": "CdkStack/fypUpdateLeaderboards/SqsEventSource:CdkStackfypUpdateLeaderboardsSQSA13E6ACE/Resource"
   }
  },
  "CDKMetadata": {
   "Type": "AWS::CDK::Metadata",
   "Properties": {
    "Analytics": "v2:deflate64:H4sIAAAAAAAA/2WOwU7DMBBEv6X3zdK0HDhTwa1SSMsZOfZSbZN4S2wXVZb/HTsBhMRpnmesmd1gXd9jvVKfrtKmrwbuMB680j1k6y26LcbHoHvysHu3CyXQcrLsBeOro6kRGUr4wwnMzapRTG46qm6gEs6QgK5kvcPYhsUummBQY2cUxmw0NI3sHIuF52C1L5DtX34qBQcJk6a9ulzYnkr8303gPvLOS6AwD82QgNWYx+V7vGgjA+tbeS6UErTk5qr5zx/eiTVcrkhgxRCe3d11s8YHXK/OjrmagvU8EraLfgEVHW8hWwEAAA=="
   },
   "Metadata": {
    "aws:cdk:path": "CdkStack/CDKMetadata/Default"
   },
   "Condition": "CDKMetadataAvailable"
  }
 },
 "Conditions": {
  "CDKMetadataAvailable": {
   "Fn::Or": [
    {
     "Fn::Or": [
      {
       "Fn::Equals": [
        {
         "Ref": "AWS::Region"
        },
        "af-south-1"
       ]
      },
      {
       "Fn::Equals": [
        {
         "Ref": "AWS::Region"
        },
        "ap-east-1"
       ]
      },
      {
       "Fn::Equals": [
        {
         "Ref": "AWS::Region"
        },
        "ap-northeast-1"
       ]
      },
      {
       "Fn::Equals": [
        {
         "Ref": "AWS::Region"
        },
        "ap-northeast-2"
       ]
      },
      {
       "Fn::Equals": [
        {
         "Ref": "AWS::Region"
        },
        "ap-south-1"
       ]
      },
      {
       "Fn::Equals": [
        {
         "Ref": "AWS::Region"
        },
        "ap-southeast-1"
       ]
      },
      {
       "Fn::Equals": [
        {
         "Ref": "AWS::Region"
        },
        "ap-southeast-2"
       ]
      },
      {
       "Fn::Equals": [
        {
         "Ref": "AWS::Region"
        },
        "ca-central-1"
       ]
      },
      {
       "Fn::Equals": [
        {
         "Ref": "AWS::Region"
        },
        "cn-north-1"
       ]
      },
      {
       "Fn::Equals": [
        {
         "Ref": "AWS::Region"
        },
        "cn-northwest-1"
       ]
      }
     ]
    },
    {
     "Fn::Or": [
      {
       "Fn::Equals": [
        {
         "Ref": "AWS::Region"
        },
        "eu-central-1"
       ]
      },
      {
       "Fn::Equals": [
        {
         "Ref": "AWS::Region"
        },
        "eu-north-1"
       ]
      },
      {
       "Fn::Equals": [
        {
         "Ref": "AWS::Region"
        },
        "eu-south-1"
       ]
      },
      {
       "Fn::Equals": [
        {
         "Ref": "AWS::Region"
        },
        "eu-west-1"
       ]
      },
      {
       "Fn::Equals": [
        {
         "Ref": "AWS::Region"
        },
        "eu-west-2"
       ]
      },
      {
       "Fn::Equals": [
        {
         "Ref": "AWS::Region"
        },
        "eu-west-3"
       ]
      },
      {
       "Fn::Equals": [
        {
         "Ref": "AWS::Region"
        },
        "il-central-1"
       ]
      },
      {
       "Fn::Equals": [
        {
         "Ref": "AWS::Region"
        },
        "me-central-1"
       ]
      },
      {
       "Fn::Equals": [
        {
         "Ref": "AWS::Region"
        },
        "me-south-1"
       ]
      },
      {
       "Fn::Equals": [
        {
         "Ref": "AWS::Region"
        },
        "sa-east-1"
       ]
      }
     ]
    },
    {
     "Fn::Or": [
      {
       "Fn::Equals": [
        {
         "Ref": "AWS::Region"
        },
        "us-east-1"
       ]
      },
      {
       "Fn::Equals": [
        {
         "Ref": "AWS::Region"
        },
        "us-east-2"
       ]
      },
      {
       "Fn::Equals": [
        {
         "Ref": "AWS::Region"
        },
        "us-west-1"
       ]
      },
      {
       "Fn::Equals": [
        {
         "Ref": "AWS::Region"
        },
        "us-west-2"
       ]
      }
     ]
    }
   ]
  }
 },
 "Parameters": {
  "BootstrapVersion": {
   "Type": "AWS::SSM::Parameter::Value<String>",
   "Default": "/cdk-bootstrap/hnb659fds/version",
   "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]"
  }
 },
 "Rules": {
  "CheckBootstrapVersion": {
   "Assertions": [
    {
     "Assert": {
      "Fn::Not": [
       {
        "Fn::Contains": [
         [
          "1",
          "2",
          "3",
          "4",
          "5"
         ],
         {
          "Ref": "BootstrapVersion"
         }
        ]
       }
      ]
     },
     "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI."
    }
   ]
  }
 }
}